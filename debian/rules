#!/usr/bin/make -f

dh = --dbg-package=phonon-dbg

include /usr/share/pkg-kde-tools/qt-kde-team/2/debian-qt-kde.mk

# Enable strict interdependencies
DEB_STRICT_LOCAL_SHLIBS_PACKAGES = $(DEB_LIBRARY_PACKAGES)
include /usr/share/pkg-kde-tools/qt-kde-team/2/library-packages.mk

RECOMMENDED_PHONON_BACKEND := phonon-backend-vlc

override_dh_auto_configure:
	$(configure_dh_auto_configure) -- -DPLUGIN_INSTALL_DIR=/usr/lib/qt4/

# shlibs is needed for library-packages.mk (strict shlibs) to work
override_dh_makeshlibs:
	$(binary_dh_makeshlibs) -plibphonon4 -V'libphonon4 (>= $(dqk_upstream_version)), phonon'
	$(binary_dh_makeshlibs) -V --remaining-packages

override_dh_shlibdeps:
	dh_shlibdeps -- -xphonon

override_dh_gencontrol:
	# Expand some variables in maintainer scripts and debconf templates
	@for f in debian/*/DEBIAN/post* \
	          debian/*/DEBIAN/pre* \
	          debian/*/DEBIAN/config \
	          debian/*/DEBIAN/templates; do \
	    if [ -f "$$f" ]; then \
	        cmd="awk -f debian/expand_vars.awk -v recommended_backend='$(RECOMMENDED_PHONON_BACKEND)' -- $$f > $$f.tmp && cat $$f.tmp >| $$f && rm -f $$f.tmp"; \
	        echo "$$cmd"; eval "$$cmd"; \
	    fi; \
	done
	dh_gencontrol -- -Vphonon:Recommended-Backend=$(RECOMMENDED_PHONON_BACKEND)
